"use strict";!function(){function e(){var e=this;this.get=function(e,t){var n=XMLHttpRequest?new XMLHttpRequest:new ActiveXObject;n.open("get",e,!1),console.log("get"),n.addEventListener("load",function(){n.status<400&&(console.log("xhr ok."),t(n.responseText))}),n.send(null)};var t=null,n=null;this.map={},this.mapOptions={},this.markers=[],this.markerReferences=[];var r=function(){t?t.close():null,e.markerReferences.forEach(function(e){e.setMap(null)})},o=function(t){t.forEach(function(t){t.setMap(e.map)})},a=function(){var t=document.querySelector("#categories-all"),n=document.querySelector("#categories-transport"),a=document.querySelector("#categories-traffic"),i=document.querySelector("#categories-disturbance"),c=document.querySelector("#categories-other");t.addEventListener("click",function(){r(),o(e.markerReferences)},!1),a.addEventListener("click",function(){r(),o(e.markerReferences.filter(function(e){return 0===e.trafficCategory}))},!1),n.addEventListener("click",function(){r(),o(e.markerReferences.filter(function(e){return 1===e.trafficCategory}))},!1),i.addEventListener("click",function(){r(),o(e.markerReferences.filter(function(e){return 2===e.trafficCategory}))},!1),c.addEventListener("click",function(){r(),o(e.markerReferences.filter(function(e){return 3===e.trafficCategory}))},!1)},i=function(e){var t="<div><h3>"+e.title+"</h3><span>"+e.category+" "+e.date+"</span><p>"+e.description+"</p></div>",n=new google.maps.InfoWindow({content:t});return n},c=function(r,o){var a=new google.maps.MarkerImage("http://chart.apis.google.com/chart?chst=d_map_pin_letter&chld=%E2%80%A2|"+r.markerPriorityColor,new google.maps.Size(21,34),new google.maps.Point(0,0),new google.maps.Point(10,34)),c=i(r),s=new google.maps.Marker({position:new google.maps.LatLng(r.latitude,r.longitude),title:r.title,animation:google.maps.Animation.DROP,map:e.map,icon:a,trafficId:r.id,trafficCategory:r.categoryNumber});console.log("markerToAdd.id, inside pinMarker"),console.log(r.id),google.maps.event.addListener(s,"click",function(){n&&(n.setAnimation(null),t.close()),n=s,t=c,t.open(e.map,n),n.setAnimation(google.maps.Animation.BOUNCE)}),e.markerReferences.push(s),o()},s=function(t){console.log("addMarkerToMenu marker.id"),console.log(t.id);var n=document.querySelector("#traffic-events"),r=document.createElement("li"),o=document.createElement("li");o.setAttribute("class","divider");var a=document.createElement("a");a.setAttribute("data-toggle","tab"),a.innerHTML="<strong>"+t.date+"</strong> <br><em>"+t.title+"</em>";var i=document.createElement("span");i.setAttribute("style","display: block;"),i.setAttribute("id","marker"+t.id),i.setAttribute("class","text-center"),i.addEventListener("click",function(n){n=n||event,console.log("addMarkerToMenu, inside eventlistener, marker.id"),console.log(t.id),google.maps.event.trigger(e.markerReferences[t.id],"click")},!1),i.appendChild(a),r.appendChild(i),n.appendChild(r),n.appendChild(o)},l=function(t){e.markers=JSON.parse(t).sort(function(e,t){return e.date>t.date?-1:e.date<t.date?1:0}).map(function(e,t){var n="",r="",o=new Date(+e.createddate.substring(6,e.createddate.length-7)).toLocaleString();switch(e.priority){case 1:n="F51329";break;case 2:n="F98020";break;case 3:n="F9EB18";break;case 4:n="85E0F7";break;case 5:n="85E0F7"}switch(e.category){case 0:r="Vägtrafik";break;case 1:r="Kollektivtrafik";break;case 2:r="Planerad störning";break;case 3:r="Övrigt"}return{id:t,title:e.title,latitude:e.latitude,longitude:e.longitude,description:e.description,markerPriorityColor:n,category:r,categoryNumber:e.category,name:e.name,zoom:e.zoom,date:o}}).forEach(function(e){c(e,a),s(e)}),console.table(e.markerReferences)};this.init=function(){e.mapOptions={center:{lat:56.6874601,lng:16.326955},zoom:5},e.map=new google.maps.Map(document.querySelector("#google-map-container"),e.mapOptions),e.get("http://localhost:8080/traffic-data",l)}}var t=function(){console.log("TrafficReport ES6.");var t=new e;t.init()};google.maps.event.addDomListener(window,"load",t)}();